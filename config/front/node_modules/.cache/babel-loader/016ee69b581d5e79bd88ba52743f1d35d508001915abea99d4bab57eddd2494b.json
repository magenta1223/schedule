{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, createCommentVNode as _createCommentVNode, createTextVNode as _createTextVNode, withCtx as _withCtx, toDisplayString as _toDisplayString, openBlock as _openBlock, createBlock as _createBlock } from \"vue\";\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_v_checkbox = _resolveComponent(\"v-checkbox\");\n  const _component_v_icon = _resolveComponent(\"v-icon\");\n  const _component_PlayerSelect = _resolveComponent(\"PlayerSelect\");\n  const _component_v_btn = _resolveComponent(\"v-btn\");\n  const _component_v_card_actions = _resolveComponent(\"v-card-actions\");\n  const _component_v_card = _resolveComponent(\"v-card\");\n  const _component_EasyDataTable = _resolveComponent(\"EasyDataTable\");\n  const _component_v_card_title = _resolveComponent(\"v-card-title\");\n  const _component_v_card_text = _resolveComponent(\"v-card-text\");\n  const _component_v_dialog = _resolveComponent(\"v-dialog\");\n  const _component_v_container = _resolveComponent(\"v-container\");\n  return _openBlock(), _createBlock(_component_v_container, null, {\n    default: _withCtx(() => [_createVNode(_component_EasyDataTable, {\n      headers: _ctx.headers,\n      items: _ctx.songs,\n      \"table-class-name\": \"customize-table\",\n      \"show-index\": \"\",\n      \"body-text-direction\": \"center\",\n      \"header-text-direction\": \"center\",\n      \"hide-rows-per-page\": true\n    }, {\n      \"item-fix\": _withCtx(item => [_createVNode(_component_v_checkbox, {\n        modelValue: _ctx.selectedSongs[item.index],\n        \"onUpdate:modelValue\": $event => _ctx.selectedSongs[item.index] = $event,\n        density: \"compact\",\n        class: \"cbox\"\n      }, null, 8 /* PROPS */, [\"modelValue\", \"onUpdate:modelValue\"])]),\n      \"item-delete\": _withCtx(item => [_createVNode(_component_v_icon, {\n        icon: _ctx.icons.mdiDelete,\n        onClick: $event => $options.modal(item),\n        density: \"compact\"\n      }, null, 8 /* PROPS */, [\"icon\", \"onClick\"])]),\n      expand: _withCtx(item => [_createVNode(_component_v_card, {\n        class: \"elevation-0 pa-2\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_PlayerSelect, {\n          song: $options.sex(item)\n        }, null, 8 /* PROPS */, [\"song\"]), _createCommentVNode(\" <EasyDataTable\\r\\n                        :headers=\\\"manage_header\\\"\\r\\n                        :items=\\\"serialize(item)\\\"\\r\\n                        body-text-direction =\\\"center\\\"\\r\\n                        header-text-direction = \\\"center\\\"\\r\\n                        :hide-rows-per-page=\\\"true\\\"\\r\\n                        show-index\\r\\n                    >\\r\\n                        <template #item-player=\\\"item\\\">\\r\\n                            <td>\\r\\n                                <v-select\\r\\n                                v-model=\\\"selectedPlayers[item.position]\\\"\\r\\n                                :items=\\\"item.player\\\"\\r\\n                                item-title=\\\"name\\\"\\r\\n                                item-value=\\\"id\\\"\\r\\n                                density=\\\"compact\\\"\\r\\n                                >                                      \\r\\n                                </v-select>\\r\\n                            </td>\\r\\n                        </template>\\r\\n                    </EasyDataTable> \"), _createVNode(_component_v_card_actions, null, {\n          default: _withCtx(() => [_createVNode(_component_v_btn, {\n            width: \"100%\",\n            onClick: $event => $options.fix(item)\n          }, {\n            default: _withCtx(() => [_createTextVNode(\" FIX \")]),\n            _: 2 /* DYNAMIC */\n          }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])]),\n          _: 2 /* DYNAMIC */\n        }, 1024 /* DYNAMIC_SLOTS */)]),\n\n        _: 2 /* DYNAMIC */\n      }, 1024 /* DYNAMIC_SLOTS */)]),\n\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"headers\", \"items\"]), _createVNode(_component_v_dialog, {\n      modelValue: _ctx.openModal,\n      \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => _ctx.openModal = $event)\n    }, {\n      default: _withCtx(() => [_createVNode(_component_v_card, {\n        \"max-width\": \"600px\",\n        class: \"dialog\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_v_card_title, null, {\n          default: _withCtx(() => [_createTextVNode(\" Delete Song \")]),\n          _: 1 /* STABLE */\n        }), _createVNode(_component_v_card_text, null, {\n          default: _withCtx(() => [_createTextVNode(\" Are you sure to delete \" + _toDisplayString(_ctx.delItem.title) + \"? \", 1 /* TEXT */)]),\n\n          _: 1 /* STABLE */\n        }), _createVNode(_component_v_card_actions, null, {\n          default: _withCtx(() => [_createVNode(_component_v_btn, {\n            color: \"error\",\n            variant: \"outlined\",\n            width: \"100%\",\n            onClick: _cache[0] || (_cache[0] = $event => $options.deleteSong(_ctx.delItem))\n          }, {\n            default: _withCtx(() => [_createTextVNode(\" Delete \")]),\n            _: 1 /* STABLE */\n          })]),\n\n          _: 1 /* STABLE */\n        })]),\n\n        _: 1 /* STABLE */\n      })]),\n\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"modelValue\"]), _createVNode(_component_PlayerSelect, {\n      song: _ctx.songs[0]\n    }, null, 8 /* PROPS */, [\"song\"])]),\n    _: 1 /* STABLE */\n  });\n}","map":{"version":3,"mappings":";;;;;;;;;;;;;uBACIA,aAoEcC;sBAnEV,MAgDgB,CAhDhBC,aAgDgBC;MA/CXC,OAAO,EAAEC,YAAO;MAChBC,KAAK,EAAED,UAAK;MACb,kBAAgB,EAAC,iBAAiB;MAClC,YAAU,EAAV,EAAU;MACV,qBAAmB,EAAE,QAAQ;MAC7B,uBAAqB,EAAG,QAAQ;MAC/B,oBAAkB,EAAE;;MAEV,UAAQ,WAAEE,IAAI,KACrBL,aAA6FM;oBAAvEH,kBAAa,CAACE,IAAI,CAACE,KAAK;yCAAxBJ,kBAAa,CAACE,IAAI,CAACE,KAAK;QAAGC,OAAO,EAAC,SAAS;QAACC,KAAK,EAAC;;MAElE,aAAW,WAAEJ,IAAI,KACxBL,aAAiFU;QAAxEC,IAAI,EAAER,UAAK,CAACS,SAAS;QAAGC,OAAK,YAAEC,cAAK,CAACT,IAAI;QAAIG,OAAO,EAAC;;MAEvDO,MAAM,WAAEV,IAAI,KACnBL,aA8BSgB;QA9BDP,KAAK,EAAC;MAAkB;0BAC5B,MAEE,CAFFT,aAEEiB;UADDC,IAAI,EAAEJ,YAAG,CAACT,IAAI;2CAEfc,yiCAoBoB,EACpBnB,aAIiBoB;4BAHb,MAEQ,CAFRpB,aAEQqB;YAFDC,KAAK,EAAG,MAAM;YAAET,OAAK,YAAEC,YAAG,CAACT,IAAI;;8BAAG,MAEzC,kBAFyC,OAEzC;;;;;;;;;;6CAKhBL,aAcWuB;kBAdSpB,cAAS;iEAATA,cAAS;;wBACzB,MAYS,CAZTH,aAYSgB;QAZD,WAAS,EAAC,OAAO;QAACP,KAAK,EAAC;;0BAC5B,MAEe,CAFfT,aAEewB;4BAFD,MAEd,kBAFc,eAEd;;YACAxB,aAEcyB;4BAFD,MACc,kBADd,0BACc,oBAAEtB,YAAO,CAACuB,KAAK,IAAE,IAC5C;;;YACA1B,aAIiBoB;4BAHb,MAEQ,CAFRpB,aAEQqB;YAFDM,KAAK,EAAC,OAAO;YAAEC,OAAO,EAAC,UAAU;YAACN,KAAK,EAAC,MAAM;YAAET,OAAK,sCAAEC,mBAAU,CAACX,YAAO;;8BAAG,MAEnF,kBAFmF,UAEnF;;;;;;;;;;;uCAIZH,aAEEiB;MADDC,IAAI,EAAEf,UAAK","names":["_createBlock","_component_v_container","_createVNode","_component_EasyDataTable","headers","_ctx","items","item","_component_v_checkbox","index","density","class","_component_v_icon","icon","mdiDelete","onClick","$options","expand","_component_v_card","_component_PlayerSelect","song","_createCommentVNode","_component_v_card_actions","_component_v_btn","width","_component_v_dialog","_component_v_card_title","_component_v_card_text","title","color","variant"],"sourceRoot":"","sources":["C:\\schedule\\config\\front\\src\\views\\Project\\Manage\\ManageSongs.vue"],"sourcesContent":["<template>\r\n    <v-container>\r\n        <EasyDataTable\r\n            :headers=\"headers\"\r\n            :items=\"songs\"\r\n            table-class-name=\"customize-table\"\r\n            show-index\r\n            body-text-direction =\"center\"\r\n            header-text-direction = \"center\"\r\n            :hide-rows-per-page=\"true\"\r\n        >\r\n            <template #item-fix=\"item\">\r\n                <v-checkbox  v-model=\"selectedSongs[item.index]\" density=\"compact\" class=\"cbox\"></v-checkbox>\r\n            </template>\r\n            <template #item-delete=\"item\">\r\n                <v-icon :icon=\"icons.mdiDelete\" @click=\"modal(item)\"  density=\"compact\"></v-icon>\r\n            </template>\r\n            <template #expand=\"item\">\r\n                <v-card class=\"elevation-0 pa-2\">\r\n                    <PlayerSelect\r\n                    :song=\"sex(item)\"\r\n                    />\r\n                    <!-- <EasyDataTable\r\n                        :headers=\"manage_header\"\r\n                        :items=\"serialize(item)\"\r\n                        body-text-direction =\"center\"\r\n                        header-text-direction = \"center\"\r\n                        :hide-rows-per-page=\"true\"\r\n                        show-index\r\n                    >\r\n                        <template #item-player=\"item\">\r\n                            <td>\r\n                                <v-select\r\n                                v-model=\"selectedPlayers[item.position]\"\r\n                                :items=\"item.player\"\r\n                                item-title=\"name\"\r\n                                item-value=\"id\"\r\n                                density=\"compact\"\r\n                                >                                      \r\n                                </v-select>\r\n                            </td>\r\n                        </template>\r\n                    </EasyDataTable> -->\r\n                    <v-card-actions>\r\n                        <v-btn width = \"100%\" @click=\"fix(item)\">\r\n                            FIX\r\n                        </v-btn>\r\n                    </v-card-actions>\r\n                </v-card>\r\n            </template>\r\n        </EasyDataTable>\r\n        <v-dialog v-model =\"openModal\" >\r\n            <v-card max-width=\"600px\" class=\"dialog\">\r\n                <v-card-title>\r\n                    Delete Song\r\n                </v-card-title>\r\n                <v-card-text>\r\n                    Are you sure to delete {{delItem.title}}?\r\n                </v-card-text>\r\n                <v-card-actions>\r\n                    <v-btn color=\"error\"  variant=\"outlined\" width=\"100%\" @click=\"deleteSong(delItem)\">\r\n                        Delete\r\n                    </v-btn>\r\n                </v-card-actions>\r\n            </v-card>\r\n        </v-dialog>\r\n        <PlayerSelect\r\n        :song=\"songs[0]\"\r\n        />\r\n    </v-container>\r\n</template>\r\n\r\n\r\n\r\n<script>\r\n\r\nimport axios from \"axios\";\r\nimport setToken from \"@/utils/auth.js\"\r\nimport {mdiDelete} from \"@mdi/js\"\r\nimport PlayerSelect from \"@/components/Song/PlayerSelect.vue\"\r\n\r\nlet url = \"http://127.0.0.1:8000/api/project/\";  // 장고 drf 서버 주소\r\nlet song_url = \"http://127.0.0.1:8000/api/song/\";  // 장고 drf 서버 주소\r\n\r\nexport default {\r\n    name : \"ManageSongs\" , \r\n\r\n    data : () => {\r\n\r\n        return {\r\n           // project -> props\r\n            project : \"\",\r\n\r\n            //songs -> props\r\n            songs : [],\r\n            headers : [\r\n                    {text : 'Artist', value : 'artist'},\r\n                    {text : 'Title', value : 'title'},\r\n                    {text : 'Vocal', value : 'Vocal'},\r\n                    {text : 'Guitar1', value : 'Guitar1'},\r\n                    {text : 'Guitar2', value : 'Guitar2'},\r\n                    {text : 'Bass', value : 'Bass'},\r\n                    {text : 'Drum', value : 'Drum'},\r\n                    {text : 'Keyboard', value : 'Keyboard'},\r\n                    {text : 'Fix', value : 'fix'},\r\n                    {text : 'Delete', value : 'delete'},\r\n            ],\r\n            \r\n            //manage\r\n            manage_header : [\r\n                {text : \"Positions\", value : \"position\"},\r\n                {text : \"Select Player\", value : \"player\"},\r\n            ],\r\n            selectedPlayers : {},\r\n            selectedSongs : [],\r\n            openModal : false,\r\n            delItem : {\r\n                name : ''\r\n            },\r\n\r\n            icons : {\r\n                mdiDelete\r\n            }\r\n        }\r\n    },\r\n\r\n    methods : { \r\n        parsePlayer : function(song){\r\n            song.players.map((player) => {\r\n                if (player.fixed){\r\n                    song[player.position] = player.user.name \r\n                }\r\n            })\r\n            return song\r\n        },\r\n        \r\n        setIndex : function(oldSong, newSong){\r\n            newSong.index = oldSong.index\r\n            newSong = this.parsePlayer(newSong)\r\n            return newSong\r\n        }, \r\n\r\n        retrieveProject : function(){\r\n            axios({\r\n                method : \"GET\",\r\n                url : url + this.$route.query.project_id + '/',\r\n                headers : setToken(),\r\n                params : {\r\n                    user_id : localStorage.getItem('user'),\r\n                }\r\n            }).then((response) => {\r\n                this.project = response.data\r\n                this.songs = this.project.songs.map( (song, index) => {\r\n                    song.index = index\r\n                    song = this.parsePlayer(song)\r\n                    this.selectedSongs.push(song.fix)\r\n                    return song\r\n                })\r\n\r\n                this.status = this.project.status\r\n\r\n                if (parseInt(localStorage.getItem('user')) === this.project.leader){\r\n                    console.log(\"ture\")\r\n                    this.manage_mode = true\r\n                }\r\n\r\n            }).catch((error) => {\r\n                console.log(\"Failed to get retreival\", error.response);\r\n            });\r\n        },\r\n\r\n        serialize : function(item){\r\n            let instruments = {}\r\n            let selectedPlayers = {}\r\n            let players = item.players\r\n            let inst_list = Array()\r\n\r\n            players = players.map((player) => {\r\n                player.name = player.user.name\r\n                player = { ...player }; // Proxy to dictionary\r\n                return player\r\n            })\r\n\r\n            for (let i in players){\r\n                let position = players[i].position\r\n                if (!(position in instruments)){\r\n                    instruments[position] = Array()\r\n                    selectedPlayers[position] = \"\"\r\n                }\r\n                instruments[position].push(players[i])\r\n            }\r\n\r\n            for (let index in item.instruments){\r\n                let position = item.instruments[index]\r\n                inst_list.push({\r\n                    'position' : position,\r\n                    'player' : instruments[position],\r\n                    'selected' : \"\"\r\n                })\r\n            }\r\n            this.selectedPlayers = selectedPlayers\r\n            return inst_list\r\n        },\r\n\r\n        fix : function(song){\r\n            axios({\r\n                method : \"PATCH\",\r\n                url : song_url + song.id + '/',\r\n                headers : setToken(),\r\n                params : {\r\n                    user_id : localStorage.getItem('user'),\r\n                    selectedPlayers : JSON.stringify(this.selectedPlayers),\r\n                    action : \"fix\"\r\n                }\r\n            }).then((response) => {\r\n                this.songs[song.index] = this.setIndex(song, response.data)\r\n                this.manage = false\r\n            }).catch((error) => {\r\n                console.log(\"Failed to fix this song\", error.response);\r\n            });\r\n        },\r\n\r\n        save : function(){\r\n            this.selectedSongs.map((boolean, song_index)=> {\r\n                this.songs[song_index].fix = boolean\r\n            })\r\n            axios({\r\n                method : \"PATCH\",\r\n                url : url + this.project.id + '/',\r\n                headers : setToken(),\r\n                params : {\r\n                    user_id : localStorage.getItem('user'),\r\n                    project_id : this.project.id,\r\n                    selectedSongs : JSON.stringify(this.songs),\r\n                    status : this.status,\r\n                    action : \"fix\"\r\n                }\r\n            }).then((response) => {\r\n                // saved modal 띄우기\r\n                console.log(response)\r\n            }).catch((error) => {\r\n                console.log(\"Failed to fix the project\", error.response);\r\n            });\r\n\r\n        },\r\n\r\n        modal : function(item){\r\n            this.openModal = true\r\n            this.delItem = item\r\n        },\r\n\r\n\r\n        deleteSong : function(song){\r\n            //모달 띄우고 delete view로 걍 보내버리면 됨?> \r\n            axios({\r\n                method : \"DELETE\",\r\n                url : song_url + song.id,\r\n                headers : setToken(),\r\n            }).then((response) => {\r\n                response;\r\n                this.openModal = false\r\n                // this.songs에서 지우고 index 다시 세팅\r\n                this.songs.splice(song.index, 1)\r\n                this.selectedSongs.splice(song.index, 1)\r\n                this.songs = this.songs.map( (song, index) => {\r\n                    song.index = index\r\n                    return song\r\n                })\r\n                // saved modal 띄우기\r\n            }).catch((error) => {\r\n                console.log(\"Failed to delete song\", error.response);\r\n            });\r\n        },\r\n\r\n        sex : function(item){\r\n            console.log('parent', item)\r\n            return item\r\n        }\r\n    },\r\n\r\n    components : {\r\n        PlayerSelect,\r\n    },\r\n\r\n\r\n    mounted(){\r\n        this.retrieveProject()\r\n    }\r\n}\r\n</script>\r\n\r\n\r\n<style scoped>\r\n.dialog{\r\n    margin-left: auto!important; margin-right: auto!important; \r\n}\r\n\r\n.customize-table{\r\n    --easy-table-body-item-padding : 0px, 0px;\r\n    --easy-table-body-row-height : 24px!important;\r\n}\r\n\r\n\r\n.cbox >>> .v-input__control{\r\n    justify-content: center;\r\n}\r\n\r\n.cbox >>> .v-input__details{\r\n    height: 0px!important;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}